<div class="container-fluid py-2">
  <div class="row g-2">
    <div class="col-12">
      <div class="card shadow-sm">
        <div class="card-body d-flex flex-column flex-sm-row align-items-sm-center justify-content-between gap-3">
          <div>
            <h1 class="h4 mb-1">Urun Detayi</h1>
            <p class="text-secondary mb-0"><%= @product&.dig("name") || "Urun bulunamadi" %></p>
          </div>
          <div class="d-flex flex-wrap align-items-center gap-2">
            <%= link_to "Urun Listesi", products_path, class: "btn-secondary w-100" %>
            <% if @product.present? %>
              <%= link_to "Duzenle", edit_product_path(@product["id"]), class: "btn-secondary w-100" %>
              <%= link_to "Arsivle", product_path(@product["id"]), data: { turbo_method: :delete, turbo_confirm: "Bu urunu arsivlemek istediginize emin misiniz?" }, class: "btn-secondary w-100" %>
            <% end %>
            <%= new_record_button("Yeni Urun", new_product_path) %>
          </div>
        </div>
      </div>
    </div>

    <div class="col-12">
      <div class="card shadow-sm">
        <div class="card-body">
          <% if @product.present? %>
            <% if @product_images.present? %>
              <div class="mb-4">
                <div class="small fw-semibold text-uppercase text-secondary mb-2">Fotograflar</div>
                <div class="row g-2">
                  <% @product_images.each do |image| %>
                    <% image_url = product_image_public_url(image["storage_path"]) %>
                    <div class="col-6 col-sm-4 col-md-2">
                      <a href="<%= image_url %>" target="_blank" rel="noopener" class="d-block border rounded overflow-hidden bg-light">
                        <img src="<%= image_url %>" alt="<%= image["file_name"].to_s.presence || "Urun fotografi" %>" class="w-100" style="height:96px;object-fit:cover;" loading="lazy" />
                      </a>
                    </div>
                  <% end %>
                </div>
              </div>
            <% end %>

            <dl class="row g-2 mb-0">
              <div class="col-12 col-md-6"><dt class="small text-secondary text-uppercase fw-semibold">Stok Kodu</dt><dd><%= @product["sku"].to_s.presence || "-" %></dd></div>
              <div class="col-12 col-md-6"><dt class="small text-secondary text-uppercase fw-semibold">Urun</dt><dd><%= @product["name"].to_s %></dd></div>
              <div class="col-12"><dt class="small text-secondary text-uppercase fw-semibold">Aciklama</dt><dd><%= @product["description"].to_s.presence || "-" %></dd></div>
              <div class="col-12 col-md-6"><dt class="small text-secondary text-uppercase fw-semibold">Barkod / GTIN</dt><dd><%= @product["barcode"].to_s.presence || "-" %></dd></div>
              <div class="col-12 col-md-6"><dt class="small text-secondary text-uppercase fw-semibold">Tip</dt><dd><%= @product["item_type"].to_s %></dd></div>
              <div class="col-12 col-md-6"><dt class="small text-secondary text-uppercase fw-semibold">Kategori</dt><dd><%= @product.dig("categories", "name").to_s.presence || @category_labels[@product["category_id"].to_s].presence || "-" %></dd></div>
              <div class="col-12 col-md-6"><dt class="small text-secondary text-uppercase fw-semibold">Marka</dt><dd><%= @product.dig("brands", "name").to_s.presence || @brand_labels[@product["brand_id"].to_s].presence || "-" %></dd></div>
              <div class="col-12 col-md-6"><dt class="small text-secondary text-uppercase fw-semibold">Birim</dt><dd><%= @product["unit"].to_s.presence || "-" %></dd></div>
              <div class="col-12 col-md-6"><dt class="small text-secondary text-uppercase fw-semibold">Para Birimi</dt><dd><%= @product.dig("currencies", "code").to_s.presence || @currency_labels[@product["currency_id"].to_s].presence || "TRY" %></dd></div>
              <div class="col-12 col-md-6"><dt class="small text-secondary text-uppercase fw-semibold">Stok Takibi</dt><dd><%= @product["is_stock_item"] ? "Evet" : "Hayir" %></dd></div>
              <div class="col-12 col-md-6"><dt class="small text-secondary text-uppercase fw-semibold">Mevcut Stok</dt><dd><%= @product["stock_quantity"].to_s.presence || "0" %></dd></div>
              <div class="col-12 col-md-6"><dt class="small text-secondary text-uppercase fw-semibold">Minimum Stok</dt><dd><%= @product["min_stock_level"].to_s.presence || "0" %></dd></div>
              <div class="col-12 col-md-6"><dt class="small text-secondary text-uppercase fw-semibold">Aktif</dt><dd><%= @product["active"] ? "Evet" : "Hayir" %></dd></div>
              <div class="col-12 col-md-6"><dt class="small text-secondary text-uppercase fw-semibold">Satis Fiyati (KDV Haric)</dt><dd><%= number_to_currency(@product["price"], unit: "TL ", format: "%u%n") %></dd></div>
              <div class="col-12 col-md-6"><dt class="small text-secondary text-uppercase fw-semibold">Maliyet Fiyati (KDV Haric)</dt><dd><%= number_to_currency(@product["cost_price"], unit: "TL ", format: "%u%n") %></dd></div>
              <div class="col-12 col-md-6"><dt class="small text-secondary text-uppercase fw-semibold">Satis Fiyati Giris Tipi</dt><dd><%= @product["sale_price_vat_included"] ? "KDV Dahil" : "KDV Haric" %></dd></div>
              <div class="col-12 col-md-6"><dt class="small text-secondary text-uppercase fw-semibold">Maliyet Fiyati Giris Tipi</dt><dd><%= @product["cost_price_vat_included"] ? "KDV Dahil" : "KDV Haric" %></dd></div>
              <div class="col-12 col-md-6"><dt class="small text-secondary text-uppercase fw-semibold">KDV Orani</dt><dd><%= @product["vat_rate"].to_s %> %</dd></div>
            </dl>
          <% else %>
            <div class="text-secondary">Urun bulunamadi.</div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>


