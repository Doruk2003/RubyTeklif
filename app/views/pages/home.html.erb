# encoding: UTF-8
<div class="relative min-h-screen bg-[#f6f3ee]">
  <div class="fixed inset-0 -z-10 bg-[#f6f3ee]"></div>
  <div class="flex min-h-screen -mt-12">
    <input id="sidebar-toggle" type="checkbox" class="peer hidden" />

    <aside id="sidebar" class="sidebar-modern fixed inset-y-0 left-0 z-40 flex w-72 flex-col -translate-x-full text-white shadow-2xl transition-all duration-300 peer-checked:translate-x-0 lg:translate-x-0">
      <div class="sidebar-glow"></div>
      <div class="sidebar-grid"></div>
      <div class="flex h-16 items-center justify-between gap-3 border-b border-white/10 px-6">
        <div class="flex items-center gap-4">
          <div class="flex h-9 w-9 items-center justify-center rounded-xl bg-white/10 text-xs font-bold tracking-wider">RT</div>
          <div class="sidebar-text pl-1 text-sm font-semibold">RubyTeklif</div>
        </div>
      </div>

      <div class="px-6 py-5">
        <div class="flex items-center gap-3 rounded-2xl bg-white/5 p-3">
          <div class="h-12 w-12 rounded-full bg-white/10"></div>
          <div class="sidebar-text">
            <div class="text-xs text-white/60">Hoş geldin</div>
            <div class="text-sm font-semibold">Satış Ekibi</div>
          </div>
        </div>
      </div>

      <nav class="flex-1 px-4 pb-6 text-sm">
        <div class="space-y-1">
          <%= link_to root_path, class: "group sidebar-item sidebar-main sidebar-link relative flex items-center gap-3 rounded-xl px-4 py-2.5 font-semibold text-white/90", style: "font-size: 14px; line-height: 1.25rem;", data: { sidebar_item: true } do %>
            <span class="sidebar-indicator absolute left-0 top-1/2 h-7 w-1.5 -translate-y-1/2 rounded-full"></span>
            <span class="flex h-8 w-8 items-center justify-center rounded-lg text-xs font-semibold leading-none">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" class="block h-8 w-8">
                <path stroke-linecap="round" stroke-linejoin="round" d="M3 10.5L12 3l9 7.5M5 10v9a1 1 0 001 1h4v-6h4v6h4a1 1 0 001-1v-9" />
              </svg>
            </span>
           <span class="sidebar-tooltip pointer-events-none absolute left-[3.25rem] top-1/2 -translate-y-1/2 rounded-lg bg-slate-900 px-2 py-1 text-xs font-semibold text-white opacity-0 shadow-lg transition group-hover:opacity-100">Dashboard</span>
            <span class="sidebar-text">Dashboard</span>
          <% end %>

          <div class="space-y-1">
            <input id="menu-companies" type="checkbox" class="peer/menu-companies hidden" />
            <label for="menu-companies" class="group sidebar-item sidebar-main sidebar-link relative flex items-center gap-3 rounded-xl px-4 py-2.5 font-semibold text-white/70" style="font-size: 14px; line-height: 1.25rem;" data-sidebar-item="true">
              <span class="sidebar-indicator absolute left-0 top-1/2 h-7 w-1.5 -translate-y-1/2 rounded-full"></span>
              <span class="flex h-8 w-8 items-center justify-center rounded-lg text-xs font-semibold leading-none">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" class="block h-8 w-8">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 4.5h6v6h-6zM13.5 4.5h6v6h-6zM4.5 13.5h6v6h-6z" />
                  <path stroke-linecap="round" stroke-linejoin="round" d="M16.5 14v5M14 16.5h5" />
                </svg>
              </span>
              <span class="sidebar-tooltip pointer-events-none absolute left-[3.25rem] top-1/2 -translate-y-1/2 rounded-lg bg-slate-900 px-2 py-1 text-xs font-semibold text-white opacity-0 shadow-lg transition group-hover:opacity-100">Müşteriler</span>
              <span class="sidebar-text">Müşteriler</span><span class="sidebar-text ml-auto text-xs text-white/50">&#9662;</span></label>
            <div class="sidebar-sub ml-11 space-y-1 hidden peer-checked/menu-companies:block">
              <%= link_to new_company_path, class: "group sidebar-item sidebar-subitem sidebar-link relative flex items-center gap-3 rounded-lg px-3 py-2 font-semibold text-white/60", style: "font-size: 12px; line-height: 1rem;", data: { sidebar_item: true } do %>
                <span class="sidebar-indicator absolute left-0 top-1/2 h-5 w-1 -translate-y-1/2 rounded-full"></span>
                <span class="flex h-6 w-6 items-center justify-center rounded-md">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" class="block h-7 w-7">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 5v14M5 12h14" />
                  </svg>
                </span>
               <span class="sidebar-tooltip pointer-events-none absolute left-[2.75rem] top-1/2 -translate-y-1/2 rounded-lg bg-slate-900 px-2 py-1 text-[11px] font-semibold text-white opacity-0 shadow-lg transition group-hover:opacity-100 whitespace-nowrap min-w-[120px] text-center">Müşteri tanımla</span>
                <span class="sidebar-text">Müşteri tanımla</span>
              <% end %>
              <%= link_to companies_path, class: "group sidebar-item sidebar-subitem sidebar-link relative flex items-center gap-3 rounded-lg px-3 py-2 font-semibold text-white/60", style: "font-size: 12px; line-height: 1rem;", data: { sidebar_item: true } do %>
                <span class="sidebar-indicator absolute left-0 top-1/2 h-5 w-1 -translate-y-1/2 rounded-full"></span>
                <span class="flex h-6 w-6 items-center justify-center rounded-md">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" class="block h-7 w-7">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M8 6h12M8 12h12M8 18h12M4 6h.01M4 12h.01M4 18h.01" />
                  </svg>
                </span>
               <span class="sidebar-tooltip pointer-events-none absolute left-[2.75rem] top-1/2 -translate-y-1/2 rounded-lg bg-slate-900 px-2 py-1 text-[11px] font-semibold text-white opacity-0 shadow-lg transition group-hover:opacity-100 whitespace-nowrap min-w-[120px] text-center">Müşteri listesi</span>
                <span class="sidebar-text">Müşteri listesi</span>
              <% end %>
            </div>
          </div>

          <div class="space-y-1">
            <input id="menu-offers" type="checkbox" class="peer/menu-offers hidden" />
            <label for="menu-offers" class="group sidebar-item sidebar-main sidebar-link relative flex items-center gap-3 rounded-xl px-4 py-2.5 font-semibold text-white/70" style="font-size: 14px; line-height: 1.25rem;" data-sidebar-item="true">
              <span class="sidebar-indicator absolute left-0 top-1/2 h-7 w-1.5 -translate-y-1/2 rounded-full"></span>
              <span class="flex h-8 w-8 items-center justify-center rounded-lg text-xs font-semibold leading-none">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" class="block h-8 w-8">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M9 2.75h6a2 2 0 012 2V6h1.25A1.75 1.75 0 0120 7.75v11.5A1.75 1.75 0 0118.25 21H5.75A1.75 1.75 0 014 19.25V7.75A1.75 1.75 0 015.75 6H7V4.75a2 2 0 012-2z" />
                  <path stroke-linecap="round" stroke-linejoin="round" d="M9 6h6M8.5 11h7M8.5 15h7" />
                </svg>
              </span>
              <span class="sidebar-tooltip pointer-events-none absolute left-[3.25rem] top-1/2 -translate-y-1/2 rounded-lg bg-slate-900 px-2 py-1 text-xs font-semibold text-white opacity-0 shadow-lg transition group-hover:opacity-100">Teklifler</span>
              <span class="sidebar-text">Teklifler</span><span class="sidebar-text ml-auto text-xs text-white/50">&#9662;</span></label>
            <div class="sidebar-sub ml-11 space-y-1 hidden peer-checked/menu-offers:block">
              <%= link_to new_offer_path, class: "group sidebar-item sidebar-subitem sidebar-link relative flex items-center gap-3 rounded-lg px-3 py-2 font-semibold text-white/60", style: "font-size: 12px; line-height: 1rem;", data: { sidebar_item: true } do %>
                <span class="sidebar-indicator absolute left-0 top-1/2 h-5 w-1 -translate-y-1/2 rounded-full"></span>
                <span class="flex h-6 w-6 items-center justify-center rounded-md">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" class="block h-7 w-7">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 5v14M5 12h14" />
                  </svg>
                </span>
               <span class="sidebar-tooltip pointer-events-none absolute left-[2.75rem] top-1/2 -translate-y-1/2 rounded-lg bg-slate-900 px-2 py-1 text-[11px] font-semibold text-white opacity-0 shadow-lg transition group-hover:opacity-100 whitespace-nowrap min-w-[120px] text-center">Yeni teklif</span>
                <span class="sidebar-text">Yeni teklif</span>
              <% end %>
              <%= link_to offers_path, class: "group sidebar-item sidebar-subitem sidebar-link relative flex items-center gap-3 rounded-lg px-3 py-2 font-semibold text-white/60", style: "font-size: 12px; line-height: 1rem;", data: { sidebar_item: true } do %>
                <span class="sidebar-indicator absolute left-0 top-1/2 h-5 w-1 -translate-y-1/2 rounded-full"></span>
                <span class="flex h-6 w-6 items-center justify-center rounded-md">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" class="block h-7 w-7">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M8 6h12M8 12h12M8 18h12M4 6h.01M4 12h.01M4 18h.01" />
                  </svg>
                </span>
               <span class="sidebar-tooltip pointer-events-none absolute left-[2.75rem] top-1/2 -translate-y-1/2 rounded-lg bg-slate-900 px-2 py-1 text-[11px] font-semibold text-white opacity-0 shadow-lg transition group-hover:opacity-100 whitespace-nowrap min-w-[120px] text-center">Teklif listesi</span>
                <span class="sidebar-text">Teklif listesi</span>
              <% end %>
            </div>
          </div>

          <div class="space-y-1">
            <input id="menu-products" type="checkbox" class="peer/menu-products hidden" />
            <label for="menu-products" class="group sidebar-item sidebar-main sidebar-link relative flex items-center gap-3 rounded-xl px-4 py-2.5 font-semibold text-white/70" style="font-size: 14px; line-height: 1.25rem;" data-sidebar-item="true">
              <span class="sidebar-indicator absolute left-0 top-1/2 h-7 w-1.5 -translate-y-1/2 rounded-full"></span>
              <span class="flex h-8 w-8 items-center justify-center rounded-lg text-xs font-semibold leading-none">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" class="block h-8 w-8">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M3 5h2l2 11h11l2-8H7" />
                  <path stroke-linecap="round" stroke-linejoin="round" d="M9 20a1 1 0 100-2 1 1 0 000 2zM17 20a1 1 0 100-2 1 1 0 000 2z" />
                </svg>
              </span>
              <span class="sidebar-tooltip pointer-events-none absolute left-[3.25rem] top-1/2 -translate-y-1/2 rounded-lg bg-slate-900 px-2 py-1 text-xs font-semibold text-white opacity-0 shadow-lg transition group-hover:opacity-100">Ürünler</span>
              <span class="sidebar-text">Ürünler</span><span class="sidebar-text ml-auto text-xs text-white/50">&#9662;</span></label>
            <div class="sidebar-sub ml-11 space-y-1 hidden peer-checked/menu-products:block">
              <%= link_to new_product_path, class: "group sidebar-item sidebar-subitem sidebar-link relative flex items-center gap-3 rounded-lg px-3 py-2 font-semibold text-white/60", style: "font-size: 12px; line-height: 1rem;", data: { sidebar_item: true } do %>
                <span class="sidebar-indicator absolute left-0 top-1/2 h-5 w-1 -translate-y-1/2 rounded-full"></span>
                <span class="flex h-6 w-6 items-center justify-center rounded-md">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" class="block h-7 w-7">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 5v14M5 12h14" />
                  </svg>
                </span>
               <span class="sidebar-tooltip pointer-events-none absolute left-[2.75rem] top-1/2 -translate-y-1/2 rounded-lg bg-slate-900 px-2 py-1 text-[11px] font-semibold text-white opacity-0 shadow-lg transition group-hover:opacity-100 whitespace-nowrap min-w-[120px] text-center">Ürün tanımla</span>
                <span class="sidebar-text">Ürün tanımla</span>
              <% end %>
              <%= link_to products_path, class: "group sidebar-item sidebar-subitem sidebar-link relative flex items-center gap-3 rounded-lg px-3 py-2 font-semibold text-white/60", style: "font-size: 12px; line-height: 1rem;", data: { sidebar_item: true } do %>
                <span class="sidebar-indicator absolute left-0 top-1/2 h-5 w-1 -translate-y-1/2 rounded-full"></span>
                <span class="flex h-6 w-6 items-center justify-center rounded-md">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" class="block h-7 w-7">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M8 6h12M8 12h12M8 18h12M4 6h.01M4 12h.01M4 18h.01" />
                  </svg>
                </span>
               <span class="sidebar-tooltip pointer-events-none absolute left-[2.75rem] top-1/2 -translate-y-1/2 rounded-lg bg-slate-900 px-2 py-1 text-[11px] font-semibold text-white opacity-0 shadow-lg transition group-hover:opacity-100 whitespace-nowrap min-w-[120px] text-center">Ürün listesi</span>
                <span class="sidebar-text">Ürün listesi</span>
              <% end %>
            </div>
          </div>

          <%= link_to currencies_path, class: "group sidebar-item sidebar-main sidebar-link relative flex items-center gap-3 rounded-xl px-4 py-2.5 font-semibold text-white/70", style: "font-size: 14px; line-height: 1.25rem;", data: { sidebar_item: true } do %>
            <span class="sidebar-indicator absolute left-0 top-1/2 h-7 w-1.5 -translate-y-1/2 rounded-full"></span>
            <span class="flex h-8 w-8 items-center justify-center rounded-lg text-xs font-semibold leading-none">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" class="block h-8 w-8 rotate-90">
                <path stroke-linecap="round" stroke-linejoin="round" d="M7 7h10l-2-2m2 2l-2 2M17 17H7l2 2m-2-2l2-2" />
              </svg>
            </span>
           <span class="sidebar-tooltip pointer-events-none absolute left-[3.25rem] top-1/2 -translate-y-1/2 rounded-lg bg-slate-900 px-2 py-1 text-xs font-semibold text-white opacity-0 shadow-lg transition group-hover:opacity-100">Kurlar</span>
            <span class="sidebar-text">Kurlar</span>
          <% end %>

          <div class="sidebar-text mt-4 text-xs font-semibold uppercase tracking-wider text-white/50">Ayarlar</div>
          <%= link_to "#", class: "group sidebar-item sidebar-main sidebar-link relative mt-2 flex items-center gap-3 rounded-xl px-4 py-2.5 font-semibold text-white/70", style: "font-size: 14px; line-height: 1.25rem;", data: { sidebar_item: true } do %>
            <span class="sidebar-indicator absolute left-0 top-1/2 h-7 w-1.5 -translate-y-1/2 rounded-full"></span>
            <span class="flex h-8 w-8 items-center justify-center rounded-lg text-xs font-semibold leading-none">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" class="block h-8 w-8">
                <path stroke-linecap="round" stroke-linejoin="round" d="M16.5 7.5a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0zM4 20a8 8 0 0116 0" />
              </svg>
            </span>
           <span class="sidebar-tooltip pointer-events-none absolute left-[3.25rem] top-1/2 -translate-y-1/2 rounded-lg bg-slate-900 px-2 py-1 text-xs font-semibold text-white opacity-0 shadow-lg transition group-hover:opacity-100">Profil</span>
            <span class="sidebar-text">Profil</span>
          <% end %>
          <%= link_to "#", class: "group sidebar-item sidebar-main sidebar-link relative flex items-center gap-3 rounded-xl px-4 py-3 font-semibold text-white/70", style: "font-size: 14px; line-height: 1.25rem;", data: { sidebar_item: true } do %>
            <span class="sidebar-indicator absolute left-0 top-1/2 h-7 w-1.5 -translate-y-1/2 rounded-full"></span>
            <span class="relative top-[14px] flex h-8 w-8 items-center justify-center rounded-lg text-xs font-semibold leading-none overflow-visible">
              <svg viewBox="-1 -1 26 26" fill="none" stroke="currentColor" stroke-width="1.8" class="block h-8 w-8 overflow-visible">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v9" />
                <path stroke-linecap="round" stroke-linejoin="round" d="M5.636 5.636a9 9 0 1112.728 0" />
              </svg>
            </span>
            <span class="sidebar-tooltip pointer-events-none absolute left-[3.25rem] top-1/2 -translate-y-1/2 rounded-lg bg-slate-900 px-2 py-1 text-xs font-semibold text-white opacity-0 shadow-lg transition group-hover:opacity-100">Çıkış</span>
            <span class="sidebar-text">Çıkış</span>
          <% end %>
        </div>
      </nav>

      <div class="sticky bottom-4 mt-auto px-4 pb-6 pt-2">
        <button type="button" id="sidebar-collapse-btn" class="hidden w-full items-center justify-center gap-2 rounded-xl bg-transparent px-4 py-2.5 text-xs font-semibold text-white/80 transition hover:bg-sky-400/20 lg:flex">
          <span class="inline-flex h-8 w-8 items-center justify-center rounded-lg bg-white/10 text-xs font-semibold">?</span>
          <span class="sidebar-text">Menüyü daralt</span>
        </button>
        <label for="sidebar-toggle" class="mt-3 flex w-full items-center justify-center gap-2 rounded-xl bg-white/10 px-4 py-2.5 text-xs font-semibold text-white/80 transition hover:bg-sky-500/20 lg:hidden">
          <span class="inline-flex h-8 w-8 items-center justify-center rounded-lg bg-white/10 text-xs font-semibold">?</span>
          <span class="sidebar-text">Menüyü gizle</span>
        </label>
      </div>
    </aside>

    <label for="sidebar-toggle" class="fixed inset-0 z-30 hidden bg-black/30 peer-checked:block lg:hidden"></label>
    <label for="sidebar-toggle" class="fixed bottom-4 left-4 top-auto z-50 flex h-11 w-11 flex-col items-center justify-center gap-1 rounded-2xl bg-white text-slate-700 shadow-sm peer-checked:hidden lg:hidden">
      <span class="block h-0.5 w-5 bg-slate-700"></span>
      <span class="block h-0.5 w-5 bg-slate-700"></span>
      <span class="block h-0.5 w-5 bg-slate-700"></span>
      <span class="sr-only">Menüyü aç</label>

    <main id="main-content" class="flex-1 bg-[#f6f3ee] px-4 pb-8 pt-8 lg:px-8">
      <div class="mt-0 grid grid-cols-1 gap-5 lg:grid-cols-12">
        <section class="lg:col-span-8">
          <div class="grid grid-cols-1 gap-4 md:grid-cols-3">
            <% if @kpis.present? %>
              <% @kpis.each do |kpi| %>
                <% glow = kpi[:glow] || kpi[:glow_color] || begin
                  bar = kpi[:bar_class].to_s
                  if bar.include?("emerald")
                    "rgba(16, 185, 129, 0.55)"
                  elsif bar.include?("amber")
                    "rgba(245, 158, 11, 0.55)"
                  elsif bar.include?("rose")
                    "rgba(244, 63, 94, 0.55)"
                  elsif bar.include?("sky")
                    "rgba(56, 189, 248, 0.55)"
                  else
                    "rgba(148, 163, 184, 0.55)"
                  end
                end %>
                <div class="kpi-card relative overflow-hidden rounded-3xl bg-white/90 p-4 shadow-[0_8px_18px_-16px_rgba(15,23,42,0.5)] transition hover:shadow-[0_14px_26px_-18px_rgba(15,23,42,0.55)]" style="--kpi-glow:<%= glow %>;">
                  <span class="kpi-accent"></span>
                  <div class="flex items-center justify-between text-[11px] font-semibold uppercase tracking-wider text-slate-500">
                    <span><%= kpi[:label] %></span>
                    <span class="<%= kpi[:delta_class] %>" style="color: var(--kpi-accent);"><%= kpi[:delta] %></span>
                  </div>
                  <div class="mt-2 text-3xl font-semibold text-slate-900"><%= kpi[:value] %></div>
                  <div class="kpi-sparkline mt-3">
                    <% points = kpi[:spark] || [3, 6, 4, 7, 5, 8, 6, 9, 7] %>
                    <svg viewBox="0 0 120 24" class="h-6 w-full">
                      <polyline points="<%= points.each_with_index.map { |v, i| "#{i * (120.0 / (points.size - 1))},#{24 - (v.to_f / points.max) * 20}" }.join(' ') %>" />
                    </svg>
                  </div>
                  <div class="mt-3 h-1.5 w-full rounded-full bg-slate-200/70">
                    <div class="h-1.5 rounded-full <%= kpi[:bar_width] %>" style="background-image: linear-gradient(90deg, var(--kpi-bar-from), var(--kpi-bar-to));"></div>
                  </div>
                </div>
              <% end %>
            <% else %>
              <% 3.times do %>
                <div class="kpi-card relative overflow-hidden rounded-3xl bg-white/90 p-4 shadow-[0_8px_18px_-16px_rgba(15,23,42,0.5)]" style="--kpi-glow: rgba(148, 163, 184, 0.55);">
                  <span class="kpi-accent bg-slate-200"></span>
                  <div class="flex items-center justify-between">
                    <div class="h-3 w-24 rounded-full bg-slate-100 animate-pulse"></div>
                    <div class="h-3 w-10 rounded-full bg-slate-100 animate-pulse"></div>
                  </div>
                  <div class="mt-3 h-8 w-16 rounded-xl bg-slate-100 animate-pulse"></div>
                  <div class="mt-4 h-2 w-full rounded-full bg-slate-100 animate-pulse"></div>
                </div>
              <% end %>
            <% end %>
          </div>

          <div class="mt-5 rounded-3xl bg-white p-5 shadow-sm">
            <div class="flex items-center justify-between">
              <div>
                <div class="text-lg font-semibold text-slate-900">Teklif Aktivitesi</div>
                <div class="text-xs font-semibold uppercase tracking-wider text-slate-500">Bu ay</div>
              </div>
              <div class="inline-flex items-center gap-2 rounded-full bg-amber-50 px-2.5 py-1 text-xs font-semibold text-amber-700">+3,2%</div>
            </div>
            <% offer_activity = @offer_activity || [
              { label: "Yeni Teklif", value: 12, amount: 1_250_000_000 },
              { label: "Oluşturulan Teklif", value: 38, amount: 3_420_000_000 },
              { label: "Onaylanan Teklif", value: 21, amount: 2_680_000_000 },
              { label: "Bekleyen Teklif", value: 7, amount: 1_140_000_000 },
              { label: "Kapanan Teklif", value: 5, amount: 640_000_000 }
            ] %>
            <% max_activity = [offer_activity.map { |item| item[:amount].to_f }.max, 1].max %>
            <% palette = ["#6d28d9", "#7c3aed", "#8b5cf6", "#a78bfa", "#ddd6fe"] %>
            <% sorted_values = offer_activity.map { |item| item[:amount].to_f }.sort.reverse %>
            <div class="mt-4 grid grid-cols-1 gap-3 sm:grid-cols-2 md:grid-cols-5">
              <% offer_activity.each do |item| %>
                <% height_pct = ((item[:amount].to_f / max_activity) * 100).round %>
                <% rank = sorted_values.index(item[:amount].to_f) || (palette.length - 1) %>
                <% bar_color = palette[[rank, palette.length - 1].min] %>
                <div class="activity-card rounded-2xl pl-10 pr-2 py-2">
                  <div class="activity-row">
                    <div class="activity-vertical">
                      <div class="activity-column">
                        <div class="activity-bar-wrap">
                          <div class="activity-bar" style="height: <%= height_pct %>%; background-color: <%= bar_color %>;">
                            <span class="activity-tooltip">
                              <% amount_b = (item[:amount].to_f / 1_000_000_000) %>
                              <span class="activity-currency">?</span>
                              <%= format("%.2f", amount_b) %>B
                            </span>
                          </div>
                        </div>
                      </div>
                    </div>
                    <span class="activity-amount-side"><%= item[:value] %></span>
                  </div>
                  <div class="mt-2 text-xs font-semibold text-slate-600"><%= item[:label] %></div>
                </div>
              <% end %>
            </div>
          </div>

          <div class="mt-5 rounded-3xl bg-white p-5 shadow-sm">
            <div class="flex items-center justify-between">
              <div class="text-sm font-semibold text-slate-900">Son Teklifler</div>
              <%= link_to "Tümünü gör", offers_path, class: "text-xs font-semibold text-slate-500 hover:text-slate-900" %>
            </div>
          <div class="mt-4 overflow-hidden rounded-2xl border border-slate-100">
              <table class="min-w-full text-sm">
                <thead class="sticky top-0 z-10 bg-purple-50 text-xs uppercase tracking-wider text-purple-600">
                  <tr>
                    <th class="px-4 py-3 text-left font-semibold">Teklif No</th>
                    <th class="px-4 py-3 text-left font-semibold">Müşteri</th>
                    <th class="px-4 py-3 text-right font-semibold">Tutar</th>
                    <th class="px-4 py-3 text-right font-semibold">Durum</th>
                  </tr>
                </thead>
                <tbody class="divide-y divide-slate-100">
                  <% @recent_offers.each do |offer| %>
                    <tr class="bg-white hover:bg-slate-50 cursor-pointer" role="link" tabindex="0" data-row-link="<%= offer[:path] || offer[:url] || offer[:link] %>">
                      <td class="px-4 py-3 font-semibold text-slate-900"><%= offer[:number] %></td>
                      <td class="px-4 py-3 text-slate-600"><%= offer[:company] %></td>
                      <td class="px-4 py-3 text-right text-slate-600"><%= offer[:amount] %></td>
                      <td class="px-4 py-3 text-right">
                        <span class="inline-flex rounded-full px-3 py-1 text-xs font-semibold <%= offer[:status_class] %>"><%= offer[:status] %></span>
                      </td>
                    </tr>
                  <% end %>
                </tbody>
              </table>
            </div>
          </div>
        </section>

        <aside class="lg:col-span-4">
          <div class="rounded-3xl bg-white p-5 shadow-sm">
            <div class="flex items-center justify-between">
              <div class="text-sm font-semibold text-slate-900">Aylık Kâr</div>
              <div class="text-xs font-semibold text-slate-400">+26%</div>
            </div>
            <div class="mt-4 flex items-center justify-center">
              <div class="h-36 w-36 rounded-full p-[12px]" style="background: conic-gradient(#7c3aed 0 60%, #a78bfa 60% 84%, #e9d5ff 84% 100%);">
                <div class="flex h-full w-full items-center justify-center rounded-full bg-white text-sm font-semibold text-slate-700">?76.356</div>
              </div>
            </div>
            <div class="mt-4 space-y-2 text-sm text-slate-600">
              <div class="flex items-center justify-between">
                <span>Doğrudan</span>
                <span class="font-semibold text-slate-900">%60</span>
              </div>
              <div class="flex items-center justify-between">
                <span>Partner</span>
                <span class="font-semibold text-slate-900">%24</span>
              </div>
              <div class="flex items-center justify-between">
                <span>Diğer</span>
                <span class="font-semibold text-slate-900">%16</span>
              </div>
            </div>
          </div>

          <div class="mt-5 rounded-3xl bg-white p-5 shadow-sm">
            <div class="text-sm font-semibold text-slate-900">Hızlı İşlemler</div>
            <div class="mt-3 space-y-2 text-sm">
              <%= link_to "Müşteri listesi", companies_path, class: "flex items-center justify-between rounded-2xl border border-slate-100 px-4 py-2 font-semibold text-slate-700 transition hover:-translate-y-0.5 hover:bg-slate-50" %>
              <%= link_to "Teklif oluştur", new_offer_path, class: "flex items-center justify-between rounded-2xl border border-slate-100 px-4 py-2 font-semibold text-slate-700 transition hover:-translate-y-0.5 hover:bg-slate-50" %>
              <%= link_to "Ürün kataloğu", products_path, class: "flex items-center justify-between rounded-2xl border border-slate-100 px-4 py-2 font-semibold text-slate-700 transition hover:-translate-y-0.5 hover:bg-slate-50" %>
              <%= link_to "Kurlar", currencies_path, class: "flex items-center justify-between rounded-2xl border border-slate-100 px-4 py-2 font-semibold text-slate-700 transition hover:-translate-y-0.5 hover:bg-slate-50" %>
            </div>
          </div>

          <div class="mt-5 rounded-3xl bg-white p-5 shadow-sm">
            <div class="text-sm font-semibold text-slate-900">Hatırlatmalar</div>
            <ul class="mt-3 space-y-2 text-sm text-slate-600">
              <% @reminders.each do |note| %>
                <li class="rounded-2xl border border-slate-100 bg-slate-50 px-4 py-2"><%= note %></li>
              <% end %>
            </ul>
          </div>
        </aside>
      </div>

      <footer class="mt-6 text-xs text-slate-500">
        RubyTeklif • Teklif ve müşteri yönetimi
      </footer>
    </main>
  </div>

  <style>
    @media (min-width: 1024px) {
      #main-content {
        padding-left: calc(18rem + 2rem);
      }
      #sidebar.sidebar-collapsed ~ #main-content {
        padding-left: calc(5rem + 2rem);
      }
    }
    #sidebar.sidebar-collapsed {
      width: 5rem;
    }
    #sidebar.sidebar-collapsed .sidebar-text,
    #sidebar.sidebar-collapsed .sidebar-sub {
      display: none !important;
    }
    #sidebar.sidebar-collapsed .sidebar-link {
      justify-content: center;
      padding-left: 0.75rem !important;
      padding-right: 0.75rem !important;
    }
    #sidebar.sidebar-collapsed .sidebar-tooltip {
      opacity: 0 !important;
      pointer-events: none !important;
    }
    .sidebar-item.is-active .sidebar-indicator,
    .sidebar-item:hover .sidebar-indicator {
      opacity: 1 !important;
    }
    .peer\/menu-companies:checked + .sidebar-link > span:first-child svg,
    .peer\/menu-offers:checked + .sidebar-link > span:first-child svg,
    .peer\/menu-products:checked + .sidebar-link > span:first-child svg {
      filter: drop-shadow(0 0 6px rgba(56, 189, 248, 0.45));
      opacity: 0.95;
    }
    .kpi-card {
      border: 1px solid rgba(15, 23, 42, 0.06);
      background-image: linear-gradient(140deg, rgba(255, 255, 255, 0.98), rgba(248, 250, 252, 0.9));
      --kpi-spark: #a855f7;
    }
    .kpi-card:nth-child(1) {
      --kpi-accent: #6d28d9;
      --kpi-bar-from: #4c1d95;
      --kpi-bar-to: #a78bfa;
    }
    .kpi-card:nth-child(2) {
      --kpi-accent: #8b5cf6;
      --kpi-bar-from: #5b21b6;
      --kpi-bar-to: #c4b5fd;
    }
    .kpi-card:nth-child(3) {
      --kpi-accent: #d946ef;
      --kpi-bar-from: #7e22ce;
      --kpi-bar-to: #f5d0fe;
    }
    .kpi-accent {
      position: absolute;
      left: 0;
      top: 12px;
      bottom: 12px;
      width: 3px;
      border-radius: 9999px;
      opacity: 0.95;
      background: var(--kpi-accent, #7c3aed);
    }
    .kpi-card:hover .kpi-accent {
      box-shadow: 0 0 10px var(--kpi-glow, rgba(56, 189, 248, 0.55));
    }
    .kpi-sparkline svg {
      stroke: var(--kpi-spark, rgba(15, 23, 42, 0.35));
      stroke-width: 2;
      fill: none;
      opacity: 0.6;
    }
    .kpi-card:hover .kpi-sparkline svg {
      stroke: var(--kpi-spark, rgba(15, 23, 42, 0.5));
      opacity: 0.9;
    }
    .sidebar-item.is-active {
      background: rgba(148, 163, 184, 0.08);
      box-shadow: inset 0 0 0 1px rgba(148, 163, 184, 0.18);
    }
    .activity-row {
      display: flex;
      align-items: flex-end;
      gap: 16px;
    }
    .activity-vertical {
      display: flex;
      justify-content: center;
      align-items: flex-end;
      height: 96px;
    }
    .activity-column {
      position: relative;
      width: 28px;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      gap: 4px;
    }
    .activity-bar-wrap {
      height: 72px;
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      justify-content: flex-end;
      gap: 6px;
      margin-top: 10px;
    }
    .activity-bar {
      width: 100%;
      border-radius: 0;
      position: relative;
    }
    .activity-amount-side {
      font-size: 16px;
      font-weight: 700;
      color: #1f2937;
      white-space: nowrap;
      height: 72px;
      display: flex;
      align-items: flex-end;
      line-height: 1;
    }
    .activity-currency {
      font-size: 27px;
      color: #6b7280;
      margin-bottom: 2px;
    }
    .activity-tooltip {
      position: absolute;
      left: 50%;
      bottom: 100%;
      transform: translate(-50%, -8px);
      background: rgba(255, 255, 255, 0.98);
      border: 1px solid rgba(15, 23, 42, 0.12);
      border-radius: 9999px;
      padding: 4px 8px;
      font-size: 12px;
      font-weight: 700;
      color: #0f172a;
      white-space: nowrap;
      opacity: 0;
      pointer-events: none;
      transition: opacity 120ms ease, transform 120ms ease;
      box-shadow: 0 8px 18px -12px rgba(15, 23, 42, 0.4);
    }
    .activity-bar:hover .activity-tooltip {
      opacity: 1;
      transform: translate(-50%, -12px);
    }
    .sidebar-modern {
      background: linear-gradient(180deg, #14102a 0%, #1a1233 35%, #151836 70%, #0f172a 100%);
      border-right: 1px solid rgba(168, 85, 247, 0.14);
      color: rgba(237, 233, 254, 0.92);
    }
    .sidebar-modern a,
    .sidebar-modern label,
    .sidebar-modern svg {
      color: inherit;
    }
    .sidebar-modern .sidebar-text {
      color: rgba(237, 233, 254, 0.9);
    }
    .sidebar-modern nav .sidebar-item,
    .sidebar-modern nav .sidebar-item *:not(.sidebar-indicator) {
      background: transparent !important;
      box-shadow: none !important;
    }
    .sidebar-modern nav .sidebar-main,
    .sidebar-modern nav .sidebar-subitem {
      background: transparent !important;
      box-shadow: none !important;
    }
    .sidebar-modern nav .sidebar-link {
      background: transparent !important;
      box-shadow: none !important;
    }
    .sidebar-modern nav .sidebar-item.is-active {
      background: transparent !important;
      box-shadow: none !important;
    }
    .sidebar-modern nav .sidebar-main:hover,
    .sidebar-modern nav .sidebar-subitem:hover {
      background: rgba(255, 255, 255, 0.06) !important;
    }
    .sidebar-modern .sidebar-tooltip {
      background: rgba(30, 16, 59, 0.9);
      color: #f5f3ff;
    }
    .sidebar-glow {
      position: absolute;
      inset: -10% -30% auto -30%;
      height: 70%;
      background: radial-gradient(closest-side, rgba(168, 85, 247, 0.35), rgba(15, 23, 42, 0));
      filter: blur(16px);
      pointer-events: none;
    }
    .sidebar-grid {
      position: absolute;
      inset: 0;
      background-image: linear-gradient(rgba(255, 255, 255, 0.04) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
      background-size: 24px 24px;
      mask-image: linear-gradient(to bottom, rgba(0, 0, 0, 0.6), transparent 70%);
      pointer-events: none;
    }
    .sidebar-modern > *:not(.sidebar-glow):not(.sidebar-grid) {
      position: relative;
      z-index: 1;
    }
    .sidebar-indicator {
      background: linear-gradient(180deg, #a855f7, #7c3aed) !important;
      box-shadow: 0 0 12px rgba(124, 58, 237, 0.6) !important;
      display: block;
      z-index: 2;
      pointer-events: none;
    }
    .activity-badge {
      position: absolute;
      top: -24px;
      padding: 2px 6px;
      border-radius: 9999px;
      font-size: 10px;
      font-weight: 700;
      color: #0f172a;
      background: rgba(255, 255, 255, 0.95);
      border: 1px solid rgba(15, 23, 42, 0.08);
      opacity: 0;
      transform: translateY(4px);
      transition: opacity 120ms ease, transform 120ms ease;
      pointer-events: none;
    }
    .activity-card:hover .activity-badge {
      opacity: 1;
      transform: translateY(0);
    }
    .sidebar-link *:not(.sidebar-indicator) {
      color: inherit !important;
      font-size: inherit !important;
      line-height: inherit !important;
      font-weight: inherit !important;
      opacity: 1 !important;
    }
    .sidebar-indicator {
      opacity: 0 !important;
    }
    .sidebar-item:hover .sidebar-indicator,
    .sidebar-link:hover .sidebar-indicator,
    .sidebar-item.is-active .sidebar-indicator {
      opacity: 1 !important;
    }
    .sidebar-link:hover .sidebar-text,
    .sidebar-link:focus .sidebar-text,
    .sidebar-link:active .sidebar-text {
      font-size: inherit !important;
      line-height: inherit !important;
      font-weight: inherit !important;
      opacity: 1 !important;
    }
    .sidebar-main {
      font-size: 0.875rem !important;
      line-height: 1.25rem !important;
      font-weight: 600 !important;
      color: rgba(255, 255, 255, 0.7) !important;
    }
    .sidebar-subitem {
      font-size: 0.75rem !important;
      line-height: 1rem !important;
      font-weight: 600 !important;
      color: rgba(255, 255, 255, 0.6) !important;
    }
  </style>

  <script>
    const initSidebar = () => {
      const sidebar = document.getElementById("sidebar");
      const collapseBtn = document.getElementById("sidebar-collapse-btn");
      const toggle = document.getElementById("sidebar-toggle");
      const submenuIds = ["menu-companies", "menu-offers", "menu-products"];

      if (!sidebar || sidebar.dataset.bound) return;
      sidebar.dataset.bound = "true";

      if (collapseBtn) {
        collapseBtn.addEventListener("click", (event) => {
          event.preventDefault();
          event.stopPropagation();
          sidebar.classList.toggle("sidebar-collapsed");
        });
      }

      const items = Array.from(document.querySelectorAll("[data-sidebar-item]"));
      if (items.length) {
        items.forEach((item) => {
          item.addEventListener("click", () => {
            items.forEach((el) => el.classList.remove("is-active"));
            item.classList.add("is-active");
          });
        });

        const path = window.location.pathname || "/";
        let bestMatch = null;
        let bestLen = -1;
        items.forEach((item) => {
          const link = item.tagName === "A" ? item : item.querySelector("a");
          if (!link) return;
          const href = link.getAttribute("href");
          if (!href || !href.startsWith("/")) return;
          if (href === "/" && path === "/") {
            bestMatch = item;
            bestLen = 1;
            return;
          }
          if (href !== "/" && path.startsWith(href) && href.length > bestLen) {
            bestMatch = item;
            bestLen = href.length;
          }
        });
        if (bestMatch) {
          items.forEach((el) => el.classList.remove("is-active"));
          bestMatch.classList.add("is-active");
        }
      }

      submenuIds.forEach((id) => {
        const input = document.getElementById(id);
        if (!input) return;
        const stored = window.localStorage.getItem(`sidebar:${id}`);
        if (stored !== null) {
          input.checked = stored === "1";
        }
        input.addEventListener("change", () => {
          window.localStorage.setItem(`sidebar:${id}`, input.checked ? "1" : "0");
        });
      });

      if (toggle) {
        const lockScroll = () => {
          if (window.innerWidth < 1024 && toggle.checked) {
            document.body.style.overflow = "hidden";
          } else {
            document.body.style.overflow = "";
          }
        };
        lockScroll();
        toggle.addEventListener("change", lockScroll);
        window.addEventListener("resize", lockScroll);

        const closeOnMobile = () => {
          if (window.innerWidth < 1024) toggle.checked = false;
        };
        items.forEach((item) => {
          item.addEventListener("click", closeOnMobile);
        });
      }
    };

    document.addEventListener("DOMContentLoaded", initSidebar);
    document.addEventListener("turbo:load", initSidebar);

    const initTableLinks = () => {
      document.querySelectorAll("[data-row-link]").forEach((row) => {
        const url = row.getAttribute("data-row-link");
        if (!url) return;
        row.addEventListener("click", () => {
          window.location.href = url;
        });
        row.addEventListener("keydown", (event) => {
          if (event.key === "Enter" || event.key === " ") {
            event.preventDefault();
            window.location.href = url;
          }
        });
      });
    };

    document.addEventListener("DOMContentLoaded", initTableLinks);
    document.addEventListener("turbo:load", initTableLinks);
  </script>
</div>











