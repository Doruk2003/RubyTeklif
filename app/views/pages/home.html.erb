<div class="container-fluid pt-0 pb-3 px-0 home-page-root">
  <nav class="navbar navbar-expand-lg bg-primary home-nav mb-3 w-100 rounded-0" data-bs-theme="dark">
    <div class="container-fluid">
      <div class="home-nav-top w-100">
        <h1 class="home-nav-top-title">COTIL TENTE A.Ş.</h1>
        <div class="d-flex gap-2">
          <%= link_to ajanda_path,
                      class: "rt-icon-btn home-agenda-btn",
                      aria: { label: "Ajanda" },
                      data: { tip: "Ajanda" } do %>
            <span class="material-symbols-outlined" aria-hidden="true">calendar_clock</span>
          <% end %>
          <%= link_to logout_path,
                      class: "rt-icon-btn home-power-btn",
                      aria: { label: "Kapat" },
                      data: { tip: "Kapat", turbo_method: :delete, turbo_confirm: "Oturumu kapatmak istiyor musunuz?" } do %>
            <span class="material-symbols-outlined" aria-hidden="true">power_settings_new</span>
          <% end %>
        </div>
      </div>
      <div class="home-nav-bottom">
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarColor03" aria-controls="navbarColor03" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarColor03">
          <div class="home-nav-menu-row">
            <div class="home-user-meta">
              <span><strong><%= current_user&.role.to_s %></strong></span>
              <span><strong><%= current_user&.name.presence || "Misafir" %></strong></span>        
            </div>
            <ul class="navbar-nav mb-2 mb-lg-0">
              <li class="nav-item">
                <%= link_to root_path, class: "nav-link active" do %>
                  Home
                  <span class="visually-hidden">(current)</span>
                <% end %>
              </li>
              <% if current_user && Roles.catalog_manage?(current_user.role) %>
                <li class="nav-item home-menu-item">
                  <button class="nav-link dropdown-toggle" type="button">MÜŞTERİLER</button>
                  <div class="home-submenu">
                    <%= link_to "Müşteri Tanımlama", new_company_path, class: "rt-arrow-hover" %>
                    <%= link_to "Müşteri Listesi", companies_path, class: "rt-arrow-hover" %>
                  </div>
                </li>
                <li class="nav-item home-menu-item">
                  <button class="nav-link dropdown-toggle" type="button">TEKLİFLER</button>
                  <div class="home-submenu">
                    <%= link_to "Yeni Teklif", offers_standart_index_path, class: "rt-arrow-hover" %>
                    <%= link_to "Teklif Listesi", offers_standart_index_path, class: "rt-arrow-hover" %>
                  </div>
                </li>
                <li class="nav-item home-menu-item">
                  <button class="nav-link dropdown-toggle" type="button">ÜRÜNLER</button>
                  <div class="home-submenu">
                    <%= link_to "Ürün Tanımla", new_product_path, class: "rt-arrow-hover" %>
                    <%= link_to "Ürün Listesi", products_path, class: "rt-arrow-hover" %>
                  </div>
                </li>
              <% end %>
              <% if current_user && Roles.finance_manage?(current_user.role) %>
                <li class="nav-item home-menu-item">
                  <button class="nav-link dropdown-toggle" type="button">KURLAR</button>
                  <div class="home-submenu">
                    <%= link_to "Kur Ekle", new_currency_path, class: "rt-arrow-hover" %>
                    <%= link_to "Kur Listesi", currencies_path, class: "rt-arrow-hover" %>
                  </div>
                </li>
              <% end %>
              <% if current_user && Roles.admin?(current_user.role) %>
                <li class="nav-item home-menu-item">
                  <button class="nav-link dropdown-toggle" type="button">AYARLAR</button>
                  <div class="home-submenu">
                    <%= link_to "Admin Panel", admin_users_path, class: "rt-arrow-hover" %>
                    <%= link_to "Activity Logs", admin_activity_logs_path, class: "rt-arrow-hover" %>
                  </div>
                </li>
              <% end %>
            </ul>
            <form class="home-search" role="search" action="<%= home_path %>" method="get">
              <input id="home-search-input" class="form-control" type="search" name="q" placeholder="Arama" aria-label="Search">
            </form>
          </div>
        </div>
      </div>
    </div>
  </nav>
  <div style="padding: 0 16px;">
    <!-- KPIs Section -->
    <div class="row g-4 mb-4">
      <% 
        kpi_colors = [
          { text: 'text-primary', bg: 'bg-primary bg-opacity-10', icon: 'monitoring' },
          { text: 'text-success', bg: 'bg-success bg-opacity-10', icon: 'account_balance_wallet' },
          { text: 'text-info', bg: 'bg-info bg-opacity-10', icon: 'assignment_turned_in' }
        ]
      %>
      <% @kpis.first(3).each_with_index do |kpi, index| %>
        <% color = kpi_colors[index % 3] %>
        <div class="col-12 col-md-4">
          <div class="card shadow-sm border-0 rounded-4 h-100 transition hover-scale" style="background: linear-gradient(145deg, #ffffff, #fdfdfd);">
            <div class="card-body p-4 d-flex align-items-center">
              <div class="flex-shrink-0 me-3">
                <div class="d-flex align-items-center justify-content-center rounded-3 <%= color[:bg] %> <%= color[:text] %>" style="width: 56px; height: 56px;">
                  <span class="material-symbols-outlined fs-2"><%= color[:icon] %></span>
                </div>
              </div>
              <div class="flex-grow-1">
                <div class="text-secondary small fw-bold text-uppercase tracking-wider mb-1 opacity-75"><%= kpi[:label] %></div>
                <div class="h3 fw-bolder mb-1 text-dark"><%= kpi[:value] %></div>
                <div class="small fw-medium <%= kpi[:delta].to_s.include?('-') ? 'text-danger' : 'text-success' %> d-flex align-items-center">
                  <span class="material-symbols-outlined fs-6 me-1"><%= kpi[:delta].to_s.include?('-') ? 'trending_down' : 'trending_up' %></span>
                  <%= kpi[:delta] %>
                </div>
              </div>
            </div>
          </div>
        </div>
      <% end %>
    </div>

    <div class="row g-4 mb-4">
      <div class="col-12 col-xl-8">
        <!-- Haftalık Akış Özeti -->
        <div class="card shadow-sm mb-4 border-0 rounded-4">
          <div class="card-header bg-white border-bottom-0 pt-4 pb-2 px-4 d-flex justify-content-between align-items-center rounded-top-4">
            <h5 class="fw-bold mb-0 text-dark d-flex align-items-center gap-2">
              <span class="material-symbols-outlined text-warning">data_exploration</span>
              Haftalık Akış Özeti
            </h5>
            <span class="badge bg-warning bg-opacity-25 text-dark fw-bold px-3 py-2 rounded-pill shadow-sm">Son 7 Gün</span>
          </div>
          <div class="card-body px-4 pb-4 pt-2">
            <div class="row g-3">
              <% flow_colors = ['border-primary', 'border-success', 'border-info'] %>
              <% @flow_stats.each_with_index do |item, idx| %>
                <div class="col-12 col-md-4">
                  <div class="p-3 h-100 bg-light rounded-4 border-start border-4 <%= flow_colors[idx % 3] %> shadow-sm transition hover-scale">
                    <div class="h4 fw-bolder text-dark mb-1"><%= item[:value] %></div>
                    <div class="small fw-bold text-secondary text-uppercase tracking-wider mb-2"><%= item[:label] %></div>
                    <div class="small text-muted mb-0"><%= item[:note] %></div>
                  </div>
                </div>
              <% end %>
            </div>
          </div>
        </div>

        <!-- Son Teklifler -->
        <div class="card shadow-sm border-0 rounded-4">
          <div class="card-header bg-white border-bottom-0 pt-4 px-4 d-flex justify-content-between align-items-center rounded-top-4">
            <h5 class="fw-bold mb-0 text-dark d-flex align-items-center gap-2">
              <span class="material-symbols-outlined text-primary">receipt_long</span>
              Son Teklifler
            </h5>
            <%= link_to offers_standart_index_path, class: "btn btn-sm btn-outline-primary rounded-pill px-3 fw-bold d-inline-flex align-items-center gap-1" do %>
              Tümü <span class="material-symbols-outlined" style="font-size: 16px;">arrow_forward</span>
            <% end %>
          </div>
          <div class="card-body p-0 mt-2">
            <div class="table-responsive">
              <table class="table table-hover align-middle mb-0 border-top">
                <thead class="bg-light bg-opacity-50">
                  <tr>
                    <th class="border-0 text-secondary fw-bold small text-uppercase ps-4">Sayfa / No</th>
                    <th class="border-0 text-secondary fw-bold small text-uppercase">Müşteri</th>
                    <th class="border-0 text-secondary fw-bold small text-uppercase">Tutar</th>
                    <th class="border-0 text-secondary fw-bold small text-uppercase">Durum</th>
                  </tr>
                </thead>
                <tbody class="border-top-0">
                  <% if @recent_offers.blank? %>
                    <tr>
                      <td colspan="4" class="text-center py-5">
                        <div class="text-muted d-flex flex-column align-items-center">
                          <span class="material-symbols-outlined fs-1 mb-2 opacity-50">inbox</span>
                          <span class="fw-medium">Henüz kayıt yok</span>
                        </div>
                      </td>
                    </tr>
                  <% else %>
                    <% @recent_offers.each do |offer| %>
                      <tr>
                        <td class="ps-4">
                          <span class="badge bg-secondary bg-opacity-10 text-secondary rounded-pill px-2 fw-medium border border-secondary border-opacity-10 font-monospace">
                            <%= offer[:number].presence || "-" %>
                          </span>
                        </td>
                        <td class="fw-bold text-dark"><%= offer[:company].presence || "-" %></td>
                        <td class="fw-bolder"><%= offer[:amount] %></td>
                        <td>
                          <% 
                            status_bg = case offer[:status].to_s.downcase
                                        when /onay/ then 'bg-success text-success'
                                        when /iptal|ret/ then 'bg-danger text-danger'
                                        when /bekle/ then 'bg-warning text-warning'
                                        else 'bg-primary text-primary'
                                        end
                          %>
                          <span class="badge <%= status_bg %> bg-opacity-10 border border-0 rounded-pill px-3 py-2 fw-bold">
                            <%= offer[:status].presence || "Hazırlanıyor" %>
                          </span>
                        </td>
                      </tr>
                    <% end %>
                  <% end %>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <div class="col-12 col-xl-4">
        <!-- Hızlı İşlemler -->
        <div class="card shadow-sm mb-4 border-0 rounded-4 overflow-hidden">
          <div class="card-header bg-primary text-white border-0 p-4">
            <h5 class="fw-bold mb-0 d-flex align-items-center gap-2">
              <span class="material-symbols-outlined">bolt</span>
              Hızlı İşlemler
            </h5>
          </div>
          <div class="list-group list-group-flush border-0">
            <% if current_user && Roles.catalog_manage?(current_user.role) %>
              <%= link_to new_company_path, class: "list-group-item list-group-item-action border-0 px-4 py-3 d-flex align-items-center gap-3" do %>
                <div class="bg-primary bg-opacity-10 text-primary rounded-circle p-2 d-inline-flex"><span class="material-symbols-outlined fs-5">domain_add</span></div>
                <span class="fw-medium text-dark">Yeni Müşteri Ekle</span>
                <span class="material-symbols-outlined ms-auto text-muted fs-5 opacity-50">chevron_right</span>
              <% end %>
              <%= link_to offers_standart_index_path, class: "list-group-item list-group-item-action border-0 px-4 py-3 d-flex align-items-center gap-3" do %>
                <div class="bg-success bg-opacity-10 text-success rounded-circle p-2 d-inline-flex"><span class="material-symbols-outlined fs-5">receipt_long</span></div>
                <span class="fw-medium text-dark">Yeni Teklif Hazırla</span>
                <span class="material-symbols-outlined ms-auto text-muted fs-5 opacity-50">chevron_right</span>
              <% end %>
              <%= link_to new_product_path, class: "list-group-item list-group-item-action border-0 px-4 py-3 d-flex align-items-center gap-3" do %>
                <div class="bg-info bg-opacity-10 text-info rounded-circle p-2 d-inline-flex"><span class="material-symbols-outlined fs-5">inventory_2</span></div>
                <span class="fw-medium text-dark">Yeni Ürün Ekle</span>
                <span class="material-symbols-outlined ms-auto text-muted fs-5 opacity-50">chevron_right</span>
              <% end %>
            <% end %>
            <% if current_user && Roles.finance_manage?(current_user.role) %>
              <%= link_to currencies_path, class: "list-group-item list-group-item-action border-0 px-4 py-3 d-flex align-items-center gap-3" do %>
                <div class="bg-warning bg-opacity-10 text-warning rounded-circle p-2 d-inline-flex"><span class="material-symbols-outlined fs-5">currency_exchange</span></div>
                <span class="fw-medium text-dark">Döviz Kurlarını Güncelle</span>
                <span class="material-symbols-outlined ms-auto text-muted fs-5 opacity-50">chevron_right</span>
              <% end %>
            <% end %>
            <% if current_user && Roles.admin?(current_user.role) %>
              <%= link_to admin_users_path, class: "list-group-item list-group-item-action border-0 px-4 py-3 d-flex align-items-center gap-3" do %>
                <div class="bg-dark bg-opacity-10 text-dark rounded-circle p-2 d-inline-flex"><span class="material-symbols-outlined fs-5">manage_accounts</span></div>
                <span class="fw-medium text-dark">Kullanıcı Yönetimi</span>
                <span class="material-symbols-outlined ms-auto text-muted fs-5 opacity-50">chevron_right</span>
              <% end %>
            <% end %>
          </div>
        </div>

        <!-- Hatırlatmalar -->
        <div class="card shadow-sm border-0 rounded-4">
          <div class="card-header bg-white border-bottom-0 pt-4 px-4 d-flex justify-content-between align-items-center rounded-top-4">
            <h5 class="fw-bold mb-0 text-dark d-flex align-items-center gap-2">
              <span class="material-symbols-outlined text-danger">event_note</span>
              Ajanda & Hatırlatmalar
            </h5>
          </div>
          <div class="card-body px-4 pb-4 pt-2">
            <% if @reminders.blank? %>
              <div class="text-center p-4 bg-light rounded-4">
                <span class="material-symbols-outlined text-muted fs-1 mb-2 opacity-50">event_available</span>
                <p class="text-muted small mb-0 fw-medium">Bugün için hatırlatıcı veya not bulunmuyor. Harika bir gün!</p>
              </div>
            <% else %>
              <div class="d-flex flex-column gap-3 mt-2">
                <% @reminders.each do |note| %>
                  <div class="d-flex align-items-start gap-3 p-3 bg-danger bg-opacity-10 rounded-4 border border-danger border-opacity-10">
                    <div class="text-danger mt-1"><span class="material-symbols-outlined fs-5">notifications_active</span></div>
                    <div class="flex-grow-1 text-dark fw-medium small lh-sm">
                      <%= note %>
                    </div>
                  </div>
                <% end %>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
