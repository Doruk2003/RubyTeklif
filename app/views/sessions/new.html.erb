<section class="erp-login-shell">
  <div class="erp-login-card">
    <div class="erp-login-grid">
      <aside class="erp-login-aside">
        <div class="erp-login-brand">Cotil Tente A.Ş.</div>
        <h3 class="erp-login-heading">ERP Giriş Platformu</h3>
        <p class="erp-login-copy">Teklif, stok ve kullanıcı süreçlerinizi tek panelden güvenle yönetin.</p>
        <ul class="erp-login-points">
          <li>Rol bazlı yetkilendirme</li>
          <li>Teklif ve müşteri takibi</li>
          <li>Merkezi kayıt ve raporlama</li>
        </ul>
      </aside>

      <div class="erp-login-main">
        <div class="erp-login-main-head">
          <p class="erp-login-kicker">Kimlik Doğrulama</p>
          <h2>GİRİŞ YAP</h2>
          <p>Devam etmek için e-posta ve şifrenizi girin.</p>
        </div>

        <%= form_with url: login_path, method: :post, local: true, class: "d-grid gap-3" do |f| %>
          <div class="form-floating">
            <%= f.email_field :email,
                  class: "form-control form-input",
                  required: true,
                  autocomplete: "email",
                  id: "login-email",
                  placeholder: " " %>
            <%= f.label :email, "E-posta", for: "login-email" %>
          </div>

          <div>
            <div class="d-flex align-items-center justify-content-end mb-0">
              <%= link_to "Şifremi unuttum", password_recovery_path, class: "small link-secondary text-decoration-none erp-login-link" %>
            </div>
            <div class="form-floating position-relative">
              <%= f.password_field :password,
                    class: "form-control form-input pe-5",
                    required: true,
                    autocomplete: "current-password",
                    id: "login-password",
                    placeholder: " " %>
              <%= f.label :password, "Şifre", for: "login-password" %>
              <button type="button"
                      id="toggle-password"
                      class="btn btn-link position-absolute top-50 end-0 translate-middle-y px-3 text-secondary"
                      aria-label="Şifreyi göster"
                      aria-pressed="false">
                <svg id="eye-open" viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M2.5 12c2.7-4.5 6.3-6.7 9.5-6.7s6.8 2.2 9.5 6.7c-2.7 4.5-6.3 6.7-9.5 6.7s-6.8-2.2-9.5-6.7z"/>
                  <circle cx="12" cy="12" r="3.5"/>
                </svg>
                <svg id="eye-closed" viewBox="0 0 24 24" class="hidden" width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M3 3l18 18"/>
                  <path d="M10.5 10.5a2.12 2.12 0 0 0 3 3"/>
                  <path d="M9.9 5.2A9.7 9.7 0 0 1 12 5.3c3.2 0 6.8 2.2 9.5 6.7a14.8 14.8 0 0 1-4.2 4.8"/>
                  <path d="M6.2 6.2A14.7 14.7 0 0 0 2.5 12c2.7 4.5 6.3 6.7 9.5 6.7a9.6 9.6 0 0 0 4.2-.9"/>
                </svg>
              </button>
            </div>
          </div>

          <div class="erp-login-actions">
            <div class="erp-login-row">
              <label class="d-flex align-items-center gap-2 mb-0">
                <%= check_box_tag :remember_me, "1", params[:remember_me].to_s == "1", class: "form-check-input mt-0" %>
                <span class="small text-body">Beni hatırla (30 gün)</span>
              </label>
              <span class="erp-login-security">Oturum güvenliği aktif</span>
            </div>

            <%= f.submit "Giriş Yap", class: "btn-primary w-100 erp-login-submit" %>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</section>

<script>
  document.addEventListener("turbo:load", function () {
    var button = document.getElementById("toggle-password");
    var input = document.getElementById("login-password");
    var openIcon = document.getElementById("eye-open");
    var closedIcon = document.getElementById("eye-closed");
    if (!button || !input || !openIcon || !closedIcon) return;
    if (button.dataset.bound === "1") return;
    button.dataset.bound = "1";

    button.addEventListener("click", function () {
      var isPassword = input.type === "password";
      input.type = isPassword ? "text" : "password";
      button.setAttribute("aria-pressed", isPassword ? "true" : "false");
      button.setAttribute("aria-label", isPassword ? "Şifreyi gizle" : "Şifreyi göster");
      openIcon.classList.toggle("hidden", isPassword);
      closedIcon.classList.toggle("hidden", !isPassword);
    });
  });
</script>
