<div class="row g-3">
  <div class="col-12">
    <div class="card shadow-sm app-header-card">
      <div class="card-body d-flex flex-column flex-sm-row align-items-sm-center justify-content-between gap-3">
        <div>
          <h1 class="h4 mb-1 text-white">Teklif Detayı</h1>
          <p class="text-secondary mb-0">Teklif #<%= @offer&.dig("offer_number").to_s.presence || "-" %></p>
        </div>
        <div class="d-flex flex-wrap align-items-center gap-2 app-header-actions">
          <%= list_nav_button(offers_path, class_name: "app-header-icon-btn", label: "Listeye Dön") %>
          <% if @offer.present? %>
            <% if @offer["deleted_at"].present? %>
              <%= link_to restore_offer_path(@offer["id"]),
                    data: { turbo_method: :patch, turbo_confirm: "Geri yükle?", tip: "Geri Yükle" },
                    class: "btn app-header-icon-btn d-inline-flex align-items-center justify-content-center",
                    aria: { label: "Geri Yükle" } do %>
                <span class="material-symbols-outlined">restore_from_trash</span>
              <% end %>
            <% else %>
              <%= link_to offer_path(@offer["id"]),
                    data: { turbo_method: :delete, turbo_confirm: "Arşivle?", tip: "Arşivle" },
                    class: "btn app-header-icon-btn d-inline-flex align-items-center justify-content-center",
                    aria: { label: "Arşivle" } do %>
                <span class="material-symbols-outlined">archive</span>
              <% end %>
            <% end %>
          <% end %>
          <%= home_nav_button(home_path, class_name: "app-header-icon-btn", icon: "home") %>
        </div>
      </div>
    </div>
  </div>

  <% if @offer.present? %>
    <div class="col-12">
      <div class="card shadow-sm">
        <div class="card-header bg-white border-bottom pt-4 px-4 pb-3">
          <h6 class="fw-bold text-secondary mb-0 d-flex align-items-center gap-2">
            <span class="material-symbols-outlined fs-5">info</span>
            Genel Bilgiler
          </h6>
        </div>
        <div class="card-body p-4">
          <div class="row g-4">
            <div class="col-6 col-md-3">
              <div class="small text-secondary text-uppercase fw-bold mb-1" style="font-size: 0.7rem; letter-spacing: 0.05em;">Müşteri</div>
              <div class="text-dark fw-semibold"><%= @offer.dig("companies", "name").to_s.presence || "-" %></div>
            </div>
            <div class="col-6 col-md-3">
              <div class="small text-secondary text-uppercase fw-bold mb-1" style="font-size: 0.7rem; letter-spacing: 0.05em;">Tarih</div>
              <div class="text-dark"><%= @offer["offer_date"].to_s %></div>
            </div>
            <div class="col-6 col-md-3">
              <div class="small text-secondary text-uppercase fw-bold mb-1" style="font-size: 0.7rem; letter-spacing: 0.05em;">Durum</div>
              <div class="text-dark">
                <span class="badge bg-info-subtle text-info border-0 px-2 rounded-pill"><%= @offer["status"].to_s.upcase %></span>
              </div>
            </div>
            <div class="col-6 col-md-3">
              <div class="small text-secondary text-uppercase fw-bold mb-1" style="font-size: 0.7rem; letter-spacing: 0.05em;">Toplam Tutar</div>
              <div class="h5 fw-bold text-primary mb-0"><%= @offer["gross_total"].to_s %></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-12">
      <div class="card shadow-sm overflow-hidden">
        <div class="card-header bg-white border-bottom pt-4 px-4 pb-3">
          <h6 class="fw-bold text-secondary mb-0 d-flex align-items-center gap-2">
            <span class="material-symbols-outlined fs-5">list_alt</span>
            Teklif Kalemleri
          </h6>
        </div>
        <div class="card-body p-0">
          <div class="table-responsive">
            <table class="table table-hover align-middle mb-0 rt-table">
              <thead>
                <tr>
                  <th class="ps-4">Ürün / Açıklama</th>
                  <th class="text-end">Miktar</th>
                  <th class="text-end">Birim Fiyat</th>
                  <th class="text-end">İskonto %</th>
                  <th class="text-end pe-4">Toplam</th>
                </tr>
              </thead>
              <tbody>
                <% Array(@offer["offer_items"]).each do |item| %>
                  <tr>
                    <td class="ps-4">
                      <div class="fw-semibold text-dark"><%= item["description"].to_s %></div>
                    </td>
                    <td class="text-end"><%= item["quantity"].to_s %></td>
                    <td class="text-end"><%= item["unit_price"].to_s %></td>
                    <td class="text-end text-danger"><%= item["discount_rate"].to_s.presence || "0" %>%</td>
                    <td class="text-end pe-4 fw-bold"><%= item["line_total"].to_s %></td>
                  </tr>
                <% end %>

                <% if Array(@offer["offer_items"]).empty? %>
                  <tr>
                    <td colspan="5" class="text-center py-5 text-secondary fst-italic">Teklif kalemi bulunmuyor.</td>
                  </tr>
                <% end %>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  <% else %>
    <div class="col-12">
      <div class="card shadow-sm p-5 text-center">
        <span class="material-symbols-outlined fs-1 text-muted mb-3">error</span>
        <h4 class="fw-bold text-dark">Teklif bulunamadı</h4>
        <p class="text-secondary">Ulaşmaya çalıştığınız teklif kaydı mevcut değil.</p>
        <div class="mt-4">
          <%= link_to "Teklif Listesine Dön", offers_path, class: "btn btn-dark px-4" %>
        </div>
      </div>
    </div>
  <% end %>
</div>


