<div class="container-fluid py-2">
  <div class="row g-2">
    <div class="col-12">
      <div class="card shadow-sm">
        <div class="card-body d-flex flex-column flex-sm-row align-items-sm-center justify-content-between gap-3">
          <div>
            <h1 class="h4 mb-1">Teklif Detayı</h1>
            <p class="text-secondary mb-0">Teklif #<%= @offer&.dig("offer_number").to_s.presence || "-" %></p>
          </div>
          <div class="d-flex flex-wrap align-items-center gap-2">
            <%= link_to "Listeye Dön", offers_path, class: "btn-secondary w-100" %>
            <% if @offer.present? %>
              <% if @offer["deleted_at"].present? %>
                <%= link_to "Geri Yükle",
                      restore_offer_path(@offer["id"]),
                      data: { turbo_method: :patch, turbo_confirm: "Bu teklifi geri yüklemek istedişinize emin misiniz?" },
                      class: "btn-secondary w-100" %>
              <% else %>
                <%= link_to "Arşivle",
                      offer_path(@offer["id"]),
                      data: { turbo_method: :delete, turbo_confirm: "Bu teklifi arşivlemek istedişinize emin misiniz?" },
                      class: "btn-secondary w-100" %>
              <% end %>
            <% end %>
          </div>
        </div>
      </div>
    </div>

    <div class="col-12">
      <div class="card shadow-sm">
        <div class="card-body">
          <% if @offer.present? %>
            <div class="row g-2 text-body mb-4">
              <div class="col-12 col-md-6"><strong>Müşteri:</strong> <%= @offer.dig("companies", "name").to_s.presence || "-" %></div>
              <div class="col-12 col-md-6"><strong>Tarih:</strong> <%= @offer["offer_date"].to_s %></div>
              <div class="col-12 col-md-6"><strong>Durum:</strong> <%= @offer["status"].to_s %></div>
              <div class="col-12 col-md-6"><strong>Toplam:</strong> <%= @offer["gross_total"].to_s %></div>
            </div>

            <div class="table-responsive">
              <table class="table table-hover align-middle mb-0">
                <thead>
                  <tr>
                    <th>Açıklama</th>
                    <th class="text-end">Miktar</th>
                    <th class="text-end">Birim Fiyat</th>
                    <th class="text-end">İskonto %</th>
                    <th class="text-end">Tutar</th>
                  </tr>
                </thead>
                <tbody>
                  <% Array(@offer["offer_items"]).each do |item| %>
                    <tr>
                      <td><%= item["description"].to_s %></td>
                      <td class="text-end"><%= item["quantity"].to_s %></td>
                      <td class="text-end"><%= item["unit_price"].to_s %></td>
                      <td class="text-end"><%= item["discount_rate"].to_s.presence || "0" %></td>
                      <td class="text-end"><%= item["line_total"].to_s %></td>
                    </tr>
                  <% end %>

                  <% if Array(@offer["offer_items"]).empty? %>
                    <tr>
                      <td colspan="5" class="text-center py-4 text-secondary">Teklif kalemi yok.</td>
                    </tr>
                  <% end %>
                </tbody>
              </table>
            </div>
          <% else %>
            <div class="text-center py-5 text-secondary">Teklif bulunamadı.</div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>


